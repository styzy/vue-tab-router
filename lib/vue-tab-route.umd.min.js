(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("vue")):"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["vue-tab-route"]=e(require("vue")):t["vue-tab-route"]=e(t["Vue"])})("undefined"!==typeof self?self:this,(function(t){return function(t){function e(e){for(var n,o,i=e[0],s=e[1],a=0,u=[];a<i.length;a++)o=i[a],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&u.push(r[o][0]),r[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);l&&l(e);while(u.length)u.shift()()}var n={},o={0:0},r={0:0};function i(t){return s.p+"vue-tab-route.umd.min."+({}[t]||t)+".js"}function s(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.e=function(t){var e=[],n={1:1,2:1};o[t]?e.push(o[t]):0!==o[t]&&n[t]&&e.push(o[t]=new Promise((function(e,n){for(var r="css/"+({}[t]||t)+"."+{1:"4971e301",2:"bfd86e31"}[t]+".css",i=s.p+r,a=document.getElementsByTagName("link"),u=0;u<a.length;u++){var c=a[u],l=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(l===r||l===i))return e()}var h=document.getElementsByTagName("style");for(u=0;u<h.length;u++){c=h[u],l=c.getAttribute("data-href");if(l===r||l===i)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var r=e&&e.target&&e.target.src||i,s=new Error("Loading CSS chunk "+t+" failed.\n("+r+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=r,delete o[t],d.parentNode.removeChild(d),n(s)},d.href=i;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){o[t]=0})));var a=r[t];if(0!==a)if(a)e.push(a[2]);else{var u=new Promise((function(e,n){a=r[t]=[e,n]}));e.push(a[2]=u);var c,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=i(t);var h=new Error;c=function(e){l.onerror=l.onload=null,clearTimeout(d);var n=r[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",h.name="ChunkLoadError",h.type=o,h.request=i,n[1](h)}r[t]=void 0}};var d=setTimeout((function(){c({type:"timeout",target:l})}),12e4);l.onerror=l.onload=c,document.head.appendChild(l)}return Promise.all(e)},s.m=t,s.c=n,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s.oe=function(t){throw console.error(t),t};var a=("undefined"!==typeof self?self:this)["webpackJsonpvue_tab_route"]=("undefined"!==typeof self?self:this)["webpackJsonpvue_tab_route"]||[],u=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var l=u;return s(s.s="fb15")}({1185:function(t,e,n){"use strict";n("da5f")},"1b62":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o={data(){return{core:null,store:null}},created(){this.tabRouterCore=this.$tabRouter.core,this.tabRouterStore=this.$tabRouter.core.store},computed:{routes(){return this.tabRouterStore.routes},pages(){return this.tabRouterStore.pages},currentPage(){return this.tabRouterStore.currentPage}},methods:{errorHandler(t){this.tabRouterCore.errorHandler(`[${this.$options.name}] ${t}`)}}}},2877:function(t,e,n){"use strict";function o(t,e,n,o,r,i,s,a){var u,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),o&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),s?(u=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=u):r&&(u=a?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),u)if(c.functional){c._injectStyles=u;var l=c.render;c.render=function(t,e){return u.call(e),l(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,u):[u]}return{exports:t,options:c}}n.d(e,"a",(function(){return o}))},8875:function(t,e,n){var o,r,i;(function(n,s){r=[],o=s,i="function"===typeof o?o.apply(e,r):o,void 0===i||(t.exports=i)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(p){var n,o,r,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,a=i.exec(p.stack)||s.exec(p.stack),u=a&&a[1]||!1,c=a&&a[2]||!1,l=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");u===l&&(n=document.documentElement.outerHTML,o=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=n.replace(o,"$1").trim());for(var d=0;d<h.length;d++){if("interactive"===h[d].readyState)return h[d];if(h[d].src===u)return h[d];if(u===l&&h[d].innerHTML&&h[d].innerHTML.trim()===r)return h[d]}return null}}return t}))},"8bbf":function(e,n){e.exports=t},da5f:function(t,e,n){},f01d:function(t,e,n){},fb15:function(t,e,n){"use strict";if(n.r(e),"undefined"!==typeof window){var o=window.document.currentScript,r=n("8875");o=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var i=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var s=n("8bbf"),a=n.n(s);class u{constructor({title:t="",name:e="",path:n="",component:o,meta:r={}}={}){this.defaultTitle=t,this.name=e,this.path=n,this.component=o,this.meta=r}}var c=u;const l=function(t){return Object.prototype.toString.call(t).match(/\s+(\w+)/)[1]};var h=l;const d=function(t,e){if("object"===typeof e){if("object"!==typeof t)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let n in e)if(!d(t[n],e[n]))return!1;return!0}return t===e};var p=d,f=function(t){let e=parseFloat(t);return isNaN(e)?0:e};class m{constructor(t){"String"===h(t)&&(t={path:t});const{name:e,path:n,query:o,title:r}=t;if(!e&&!n)throw"name和path必须至少有一个";if("*"===n)throw"path不可使用通配符'*'";this.name=e,this.path=n,this.query=o,this.title=r}_updateTitle(t){void 0!==t&&(this.title=t)}_updateQuery(t){void 0!==t&&"object"!==typeof t||p(this.query,t)||(this.query=t)}syncByRoute({defaultTitle:t}){void 0===this.title&&(this.title=t)}update({title:t,query:e}){this._updateTitle(t),this._updateQuery(e)}}var g=m;class y{constructor({id:t,route:e,location:n}){this.id=t,this.route=e,this.location=n,this.location.syncByRoute(e),this.component={name:"",options:null,instance:null}}}var b=y;class v{constructor(t=[]){this.store=a.a.observable({routes:[],pages:[],currentPage:null}),this._pageIdSeed=0;try{this._initRoutes(t)}catch(e){this.errorHandler("[init] "+e)}}_initRoutes(t){t.forEach(t=>{this.store.routes.push(new c(t))})}_getRouteByLocation(t){return this.store.routes.find(e=>e.name===t.name||e.path===t.path||"*"===e.path)}_getPageByRoute(t){return this.store.pages.find(e=>e.route===t)}_getNearbyPageByPage(t){const e=this.store.pages.findIndex(e=>e===t);return this.store.pages[e+1]||this.store.pages[e-1]}_createPageId(){return"page-"+this._pageIdSeed++}_createPage(t,e){return new b({id:this._createPageId(),route:t,location:e})}_openPage(t){this.store.pages.push(t)}_focusPage(t){this.store.currentPage=t}_reloadPage(t){const e=this._createPage(t.route,t.location),n=this.store.pages.findIndex(e=>e===t);this.store.pages.splice(n,1,e),t===this.store.currentPage&&(this.store.currentPage=e)}_closePage(t){t===this.store.currentPage&&this._focusPage(this._getNearbyPageByPage(t)),this._destroyPage(t)}_destroyPage(t){const e=this.store.pages.findIndex(e=>e===t);e<0||this.store.pages.splice(e,1)}reset(){this.store.pages=[],this.store.currentPage=null}errorHandler(t){console.error("[TabRouter] "+t)}getRoute(t){return t instanceof g||(t=new g(t)),this._getRouteByLocation(t)}open(t=""){try{const e=new g(t),n=this._getRouteByLocation(e);if(!n)throw"无法匹配路由，错误的参数:"+JSON.stringify(t);let o=this._getPageByRoute(n);o?o.location.update(e):(o=this._createPage(n,e),this._openPage(o)),this._focusPage(o)}catch(e){this.errorHandler("[open] "+e)}}focus(t=""){try{const e=new g(t),n=this._getRouteByLocation(e);if(!n)throw"无法匹配路由，错误的参数:"+JSON.stringify(t);const o=this._getPageByRoute(n);if(!o)throw"页面未渲染:"+JSON.stringify(t);this._focusPage(o)}catch(e){this.errorHandler("[focus] "+e)}}reload(t=""){try{const e=new g(t),n=this._getRouteByLocation(e);if(!n)throw"无法匹配路由，错误的参数:"+JSON.stringify(t);const o=this._getPageByRoute(n);if(!o)throw"页面未渲染:"+JSON.stringify(t);this._reloadPage(o)}catch(e){this.errorHandler("[reload] "+e)}}close(t=""){try{const e=new g(t),n=this._getRouteByLocation(e);if(!n)throw"无法匹配路由，错误的参数:"+JSON.stringify(t);const o=this._getPageByRoute(n);if(!o)throw"页面未渲染:"+JSON.stringify(t);this._closePage(o)}catch(e){this.errorHandler("[close] "+e)}}closeAll(){try{const t=Object([],this.store.pages).reverse();t.forEach(t=>{this._closePage(t)})}catch(t){this.errorHandler("[closeAll] "+t)}}}var _,w,x=v,S=n("1b62"),R={name:"TabRouterLink",mixins:[S["a"]],props:{open:{type:[String,Object],default:void 0},close:{type:[String,Object],default:void 0},tag:{type:String,default:"a"},custom:{default:void 0}},computed:{route(){return this.tabRouterCore.getRoute(this.open||this.close)},isActive(){return this.tabRouterStore.pages.some(t=>t.route===this.route)},isVisited(){return!!this.tabRouterStore.currentPage&&this.tabRouterStore.currentPage.route===this.route}},mounted(){(void 0===this.open&&void 0===this.close||void 0!==this.open&&void 0!==this.close)&&this.errorHandler("open和close不可同时为空或同时出现")},methods:{link(){this.$tabRouter[this.open?"open":"close"](this.open||this.close)}},render(t){return t(this.tag,{on:{click:()=>{void 0===this.$props.custom&&this.link()}}},this.$scopedSlots.default({route:this.route,navigate:()=>this.link(),isActive:this.isActive,isVisited:this.isVisited}))}},P=R,C=n("2877"),O=Object(C["a"])(P,_,w,!1,null,null,null),T=O.exports;T.install=function(t){t.component(T.name,T)};var $=T,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tab-router-view"},t._l(t.currentPages,(function(e){return n(e.component.name,{directives:[{name:"show",rawName:"v-show",value:e===t.currentPage,expression:"page === currentPage"}],key:e.component.name,tag:"component"})})),1)},E=[],L={name:"TabRouterView",mixins:[S["a"]],props:{default:{type:[String,Object],default:""},id:{type:String,default:""}},data(){return{componentNameSeed:0,currentPages:[]}},computed:{useCache(){return void 0!==this.cache}},created(){this.$watch("pages",async t=>{await Promise.all(t.map(async t=>{this.currentPages.find(e=>e.id===t.id)||await this.register(t)})),this.currentPages=Object.assign([],t)})},mounted(){this.default&&this.tabRouterCore.open(this.default)},methods:{createComponentName(){return"TabRouterViewComponent"+this.componentNameSeed++},async register(t){const e=this.createComponentName();return t.component.name=e,"Function"===h(t.route.component)?t.component.options=(await t.route.component()).default:t.component.options=t.route.component,t.component.options.mixins=t.component.options.mixins||[],t.component.options.mixins.push({beforeCreate(){t.component.instance=this}}),this.$options.components[e]=t.component.options,t}},destroyed(){this.tabRouterCore.reset()}},k=L,N=Object(C["a"])(k,j,E,!1,null,null,null),B=N.exports;B.install=function(t){t.component(B.name,B)};var A=B,W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",staticClass:"tab-router-title-bar"},[n("div",{ref:"scrollWrapper",staticClass:"tab-router-title-bar-scroll-wrapper",style:{marginLeft:t.scrollOffset+"px"},on:{DOMMouseScroll:function(e){return e.stopPropagation(),t.scrollHandler.apply(null,arguments)},mousewheel:function(e){return e.stopPropagation(),t.scrollHandler.apply(null,arguments)}}},[t._l(t.pages,(function(e){return n("TabRouterTitle",{key:e.id,attrs:{page:e},on:{contextmenu:t.renderContextmenu},scopedSlots:t._u([t.$scopedSlots.title?{key:"default",fn:function(e){return[t._t("title",null,null,e)]}}:t.$slots.title?{key:"default",fn:function(e){return[t._t("title")]}}:null],null,!0)})})),t.contextmenu.isShow?n("TabRouterTitleContextmenu",{attrs:{left:t.contextmenu.left,page:t.contextmenu.page,top:t.contextmenu.top},scopedSlots:t._u([t.$scopedSlots.contextmenu?{key:"default",fn:function(e){return[t._t("contextmenu",null,null,e)]}}:t.$slots.contextmenu?{key:"default",fn:function(e){return[t._t("contextmenu")]}}:null],null,!0)}):t._e()],2)])},H=[],M={name:"TabRouterTitleBar",components:{TabRouterTitle:()=>n.e(1).then(n.bind(null,"2de8")),TabRouterTitleContextmenu:()=>n.e(2).then(n.bind(null,"11ff"))},mixins:[S["a"]],data(){return{scrollOffset:0,scrollOffsetUnit:80,isShowContextmenu:!1,contextmenu:{isShow:!1,top:0,left:0,page:null}}},mounted(){this.bindWindowResize()},destroyed(){this.unbindWindowResize()},methods:{scrollHandler(t=window.event){let e=t.wheelDelta||24*-t.detail,n=e>0;this.scroll(n)},scroll(t,e=this.scrollOffsetUnit){const n=Math.max(this.getAllTitleWidth()-this.getContainerWidth(),0);this.scrollOffset=t?Math.min(this.scrollOffset+e,0):Math.max(this.scrollOffset-e,-n)},scrollToTop(){this.scroll(!0,999999999)},scrollToBottom(){this.scroll(!1,999999999)},getContainerWidth(){return f(window.getComputedStyle(this.$refs.container)["width"])},getAllTitleWidth(){let t=0,e=this.$refs.scrollWrapper.children;return new Array(...e).forEach(e=>{t+=this.getComputedWidth(e)}),t},getComputedWidth(t){let e=window.getComputedStyle(t),n=f(e["width"])+f(e["marginLeft"])+f(e["marginRight"]);return"border-box"!==e["boxSizing"]&&(n+=f(e["paddingLeft"])+f(e["paddingRight"])+f(e["borderLeftWidth"])+f(e["borderRightWidth"])),n},bindWindowResize(){window.addEventListener("resize",this.scrollFixOnResize)},unbindWindowResize(){window.removeEventListener("resize",this.scrollFixOnResize)},scrollFixOnResize(){this.getAllTitleWidth()<this.getContainerWidth()?this.scrollToTop():-this.scrollOffset>this.getAllTitleWidth()-this.getContainerWidth()&&this.scrollToBottom()},renderContextmenu({clientY:t,clientX:e},n){console.log("render cm",n.location.title),this.contextmenu.page=n,this.contextmenu.top=t,this.contextmenu.left=e,this.contextmenu.isShow=!0,this.bindContextmenuDestroyListener()},destroyContextmenu(){this.unbindContextmenuDestroyListener(),console.log("destroy cm"),this.contextmenu.isShow=!1},bindContextmenuDestroyListener(){window.addEventListener("click",this.destroyContextmenu),window.addEventListener("contextmenu",this.destroyContextmenu,!0)},unbindContextmenuDestroyListener(){window.removeEventListener("click",this.destroyContextmenu),window.removeEventListener("contextmenu",this.destroyContextmenu,!0)}}},D=M,z=(n("1185"),Object(C["a"])(D,W,H,!1,null,null,null)),q=z.exports;q.install=function(t){t.component(q.name,q)};var I=q;n("f01d");const J="0.0.1",V=[$,A,I];class F{constructor(...t){this.core=new x(...t)}open(...t){return this.core.open(...t)}focus(...t){return this.core.focus(...t)}reload(...t){return this.core.reload(...t)}close(...t){return this.core.close(...t)}closeAll(...t){return this.core.closeAll(...t)}}F.version=J,F.install=function(t){V.forEach(e=>{t.component(e.name,e)}),t.mixin({beforeCreate(){this.$options.tabRouter&&this.$options.tabRouter instanceof F&&(t.prototype.$tabRouter=this.$options.tabRouter)}})};var U=F;e["default"]=U}})}));
//# sourceMappingURL=vue-tab-route.umd.min.js.map